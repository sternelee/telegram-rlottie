function t(){var e=document.currentScript;if(!e){var t=document.scripts;e=t[t.length-1]}return e}function QueryableWorker(e,t){const r=currentScript.src.replace("tgsticker","tgsticker-worker");var n=this,a=new Worker(r),i={};this.defaultListener=e||function(){},t&&(a.onerror=t),this.postMessage=function(e){a.postMessage(e)},this.terminate=function(){a.terminate()},this.addListener=function(e,t){i[e]=t},this.removeListener=function(e){delete i[e]},this.sendQuery=function(e){if(arguments.length<1)throw new TypeError("QueryableWorker.sendQuery takes at least one argument");e=arguments[0];var t=Array.prototype.slice.call(arguments,1);if(RLottie.isSafari)a.postMessage({queryMethod:e,queryMethodArguments:t});else{for(var r=[],n=0;n<t.length;n++)t[n]instanceof ArrayBuffer&&r.push(t[n]),t[n].buffer&&t[n].buffer instanceof ArrayBuffer&&r.push(t[n].buffer);a.postMessage({queryMethod:e,queryMethodArguments:t},r)}},a.onmessage=function(e){e.data instanceof Object&&e.data.hasOwnProperty("queryMethodListener")&&e.data.hasOwnProperty("queryMethodArguments")?i[e.data.queryMethodListener].apply(n,e.data.queryMethodArguments):this.defaultListener.call(n,e.data)}}function FrameQueue(e){this.queue=[],this.maxLength=e}var currentScript=t(),RLottie=function(){function e(){return"["+(+new Date-A)/1e3+"] "}function t(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1}function r(){return t()&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Worker&&"undefined"!=typeof ImageData}function n(){var e,t,r,a,i=+Date.now(),o=!W||i-W>1e3;for(e in h.players)t=h.players[e],t&&t.frameCount&&(r=i-t.frameThen,r>t.frameInterval&&(a=c(t,o),a&&(q=i)));var u=i-q<100?16:500;M=u<20&&F?requestAnimationFrame(n):setTimeout(n,u),o&&(W=i)}function a(){var e,t,r=!0;for(e in h.players)if(t=h.players[e],t&&t.frameCount){r=!1;break}if(!1!==M===r)if(r){F&&cancelAnimationFrame(M);try{clearTimeout(M)}catch(e){}M=!1}else M=F?requestAnimationFrame(n):setTimeout(n,0)}function i(t){if(y)t&&t();else if(t&&g.push(t),!p){console.log(e(),"tgsticker init"),p=!0;var r=h.WORKERS_LIMIT,n=v[0]=new QueryableWorker;n.addListener("ready",function(){if(console.log(e(),"worker #0 ready"),n.addListener("frame",l),n.addListener("loaded",m),--r,r)for(var t=1;t<h.WORKERS_LIMIT;t++)(function(t){var n=v[t]=new QueryableWorker;n.addListener("ready",function(){if(console.log(e(),"worker #"+t+" ready"),n.addListener("frame",l),n.addListener("loaded",m),--r,!r){console.log(e(),"workers ready"),y=!0;for(var a=0;a<g.length;a++)g[a]();g=[]}})})(t);else{console.log(e(),"workers ready"),y=!0;for(var a=0;a<g.length;a++)g[a]();g=[]}})}}function o(){for(var e=0;e<h.WORKERS_LIMIT;e++)v[e]&&(v[e].terminate(),console.log("worker #"+e+" terminated"));console.log("workers destroyed"),p=y=!1,v=[]}function u(e,t){if(!e.rlPlayer)if("picture"==e.tagName.toLowerCase()){t=t||{};var r=e.rlPlayer={};r.thumb=e.querySelector("img");var n=e.querySelector('source[type="application/x-tgsticker"]'),a=n&&n.getAttribute("srcset")||"";if(a){var i=e.clientWidth||e.getAttribute("width"),o=e.clientHeight||e.getAttribute("height"),u=t.maxDeviceRatio?Math.min(t.maxDeviceRatio,w):w;i&&o||(i=o=256),r.reqId=++k,h.players[k]=r,r.el=e,r.nextFrameNo=!1,r.frames={},r.width=Math.trunc(i*u),r.height=Math.trunc(o*u),r.rWorker=v[b++],b>=v.length&&(b=0),r.options=t,r.paused=!1,r.times=[],r.clamped=new Uint8ClampedArray(r.width*r.height*4),r.imageData=new ImageData(r.width,r.height),r.rWorker.sendQuery("loadFromData",r.reqId,a,r.width,r.height)}else console.warn("picture source application/x-tgsticker not found")}else console.warn("only picture tag allowed")}function s(e){if(e.rlPlayer){var t=e.rlPlayer;delete h.players[t.reqId],delete t,a()}}function c(e,t){if(!e.canvas||0==e.canvas.width||0==e.canvas.height)return!1;if(!e.forceRender){var r=window.isFocused?isFocused():document.hasFocus();if(!r||e.paused||!e.frameCount)return!1;var n=e.isInViewport;if(void 0===n||t){var a=e.el.getBoundingClientRect();n=!(a.bottom<0||a.right<0||a.top>(window.innerHeight||document.documentElement.clientHeight)||a.left>(window.innerWidth||document.documentElement.clientWidth)),e.isInViewport=n}if(!n)return!1}var i=e.frameQueue.shift();if(null!==i){f(e,i);var o=e.nextFrameNo;!1!==o&&(e.nextFrameNo=!1,d(e.reqId,o))}return!0}function f(e,t){e.forceRender=!1,e.imageData.data.set(t),e.context.putImageData(e.imageData,0,0);var r=+new Date;e.frameThen&&e.times.push(r-e.frameThen),e.frameThen=r-r%e.frameInterval,e.thumb&&(e.el.removeChild(e.thumb),delete e.thumb)}function d(e,t){var r=h.players[e],n=r.frames[t];n?l(e,t,n):L?r.rWorker.sendQuery("renderFrame",e,t):(r.clamped.length||(r.clamped=new Uint8ClampedArray(r.width*r.height*4)),r.rWorker.sendQuery("renderFrame",e,t,r.clamped))}function l(e,t,r){var n=h.players[e];n.options.cachingModulo&&!n.frames[t]&&(!t||(e+t)%n.options.cachingModulo)&&(n.frames[t]=new Uint8ClampedArray(r)),n.frameQueue.push(r);var a=++t;a>=n.frameCount&&(n.options.playOnce?n.paused=!0:(a=0,n.times.length&&(n.times=[]))),n.frameQueue.needsMore()?d(e,a):n.nextFrameNo=a}function m(e,t,r){var n=h.players[e];n.canvas=document.createElement("canvas"),n.canvas.width=n.width,n.canvas.height=n.height,n.el.appendChild(n.canvas),n.context=n.canvas.getContext("2d"),n.fps=r,n.frameInterval=1e3/n.fps,n.frameThen=Date.now(),n.frameCount=t,n.forceRender=!0,n.frameQueue=new FrameQueue(r/4),a(),d(e,0)}var h={},p=!1,y=!1,g=[],w=window.devicePixelRatio||1,v=[],b=0,A=+new Date;h.Api={},h.players=Object.create(null),h.WORKERS_LIMIT=4;var k=0,M=!1,W=!1,q=!1,I=window.navigator.userAgent,L=!!window.safari||!(!I||!(/\b(iPad|iPhone|iPod)\b/.test(I)||I.match("Safari")&&!I.match("Chrome"))),F=L;return h.isSafari=L,h.isSupported=r(),h.init=function(e,t){if(!h.isSupported)return!1;i(function(){u(e,t)})},h.destroy=function(e){s(e)},h.destroyWorkers=function(){o()},h}();FrameQueue.prototype.needsMore=function(){return this.queue.length<this.maxLength},FrameQueue.prototype.empty=function(){return!this.queue.length},FrameQueue.prototype.notEmpty=function(){return this.queue.length>0},FrameQueue.prototype.push=function(e){return this.queue.push(e)},FrameQueue.prototype.shift=function(){return this.queue.length?this.queue.shift():null};